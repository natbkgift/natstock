# A3 — ปิดการใช้งานราคาทุน/ราคาขาย (Feature Flag)

## เหตุผลหลัก
- ทีมปฏิบัติการต้องการตัดข้อมูลราคาทุน/ราคาขายออกจาก UI และรายงานชั่วคราว เพื่อหลีกเลี่ยงการแชร์ตัวเลขที่อ่อนไหว
- ต้องยังคงโครงสร้างฐานข้อมูลเดิมไว้เพื่อความเข้ากันได้ย้อนหลัง (เปิดกลับได้ภายหลัง)

## สิ่งที่ถูกปิด/ซ่อน
- ฟอร์มสินค้า, รายงาน, export/import preview จะไม่แสดงคอลัมน์ราคา และปุ่ม "รายงานมูลค่าสต็อก" จะกลายเป็นสถานะปิด
- API/Controller ที่รับข้อมูลสินค้าจะลบ (`strip`) ฟิลด์ `cost_price`, `sale_price` ออกอัตโนมัติเมื่อ flag ปิด
- Dashboard แสดงข้อความ "ปิดใช้งาน" แทนยอดมูลค่ารวม, service รายงาน valuation คืนค่า 0
- Template นำเข้าข้อมูล (`templates/product_template_no_price.(csv|xlsx)`) ไม่มีคอลัมน์ราคาอีกต่อไป

## วิธีเปิด/ปิด
```env
# ปิดราคา (ค่าเริ่มต้น)
INVENTORY_ENABLE_PRICE=false

# หากต้องการเปิดกลับ
INVENTORY_ENABLE_PRICE=true
```
- หลังเปลี่ยนค่าให้รัน `php artisan config:clear` หรือ deploy ตามขั้นตอน CI/CD มาตรฐาน เพื่อรีเฟรชค่า config

## ผลกระทบ/ความเสี่ยง
- เมื่อ flag ปิด ระบบจะไม่รับ/ไม่แสดงข้อมูลราคาจาก payload ใด ๆ (ข้อมูลถูกเพิกเฉย)
- รายงานมูลค่าสต็อกและการคำนวณ cost-based analytics จะให้ผลลัพธ์ 0 จนกว่าจะเปิด flag
- Template นำเข้าจากภายนอกที่ยังมีคอลัมน์ราคาจะถูกข้าม พร้อมขึ้นแจ้งเตือนในหน้าพรีวิวว่า "คอลัมน์ราคาไม่ถูกใช้งาน"

## วิธีทดสอบแบบเร็ว (Smoke Test)
1. ตั้งค่า `.env` ให้ `INVENTORY_ENABLE_PRICE=false` แล้ว `php artisan config:clear`
2. ล็อกอินในฐานะ staff:
   - เปิดฟอร์มเพิ่มสินค้า → ตรวจว่าฟิลด์ราคาหายไปและมีข้อความแจ้งว่า "ปิดการใช้งาน"
   - ลองบันทึกสินค้าใหม่พร้อมส่ง `cost_price` → ตรวจในฐานข้อมูลว่าค่าไม่ถูกบันทึก (ยังเป็น 0)
3. ไปที่เมนูรายงาน → การ์ด "รายงานมูลค่าสต็อก" ต้องเปลี่ยนเป็นปุ่มปิด พร้อมคำอธิบายภาษาไทย
4. ส่งออก CSV รายงานสต็อกต่ำด้วยพารามิเตอร์ `?export=csv` → ตรวจ header ต้องไม่พบ `ราคาทุน` หรือ `cost_price`
5. พรีวิวไฟล์นำเข้าที่มีคอลัมน์ราคา → เห็นแถบคำเตือนว่า "คอลัมน์ราคาไม่ถูกใช้งาน" และใน preview ไม่มีคอลัมน์ราคา
6. สลับ `INVENTORY_ENABLE_PRICE=true` แล้วเคลียร์ config → ยืนยันว่าฟังก์ชันราคา, ฟิลด์ และรายงานกลับมาครบถ้วน
