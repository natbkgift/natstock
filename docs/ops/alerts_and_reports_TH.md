# การใช้งานป๊อปอัปแจ้งเตือนและรายงาน

## การตั้งค่าระยะวันหมดอายุ (`expiring_days`)
1. ไปที่ **Admin ▸ ตั้งค่าระบบ**
2. กรอกค่าเช่น `30,60,90` ตามรอบติดตาม (ตัวเลขคั่นด้วยจุลภาค)
3. กดบันทึก แล้วรันปุ่ม "สแกนแจ้งเตือนทันที" เพื่อตรวจสอบผลลัพธ์

## ป๊อปอัปคงอยู่ (Persistent Alerts)
- เมื่อเข้า dashboard หากมีข้อมูลแจ้งเตือน ระบบจะโชว์ modal
- ปุ่ม **ทำเครื่องหมายว่าอ่านแล้ว** จะบันทึกลง `user_alert_states` เฉพาะผู้ใช้ปัจจุบัน
- ปุ่ม **งดเตือนวันนี้** จะ snooze ถึงสิ้นวัน และกดซ้ำได้โดยไม่สร้าง record ใหม่ (อ้างอิง payload_hash)
- หากต้องทดสอบ manual: รัน `php artisan inventory:scan-alerts` แล้วรีเฟรช dashboard

## การดูรายงาน
### รายงานใกล้หมดอายุ
- หน้า **รายงาน ▸ ใกล้หมดอายุ**
  - เลือกจำนวนวันจาก dropdown (30/60/90)
  - ฟิลเตอร์ตามหมวดหรือสถานะสินค้าได้
  - ปุ่ม "ส่งออก CSV" จะได้ header `sku,name,sub_sku,expire_date,qty,category`

### รายงานสต็อกต่ำ
- หน้า **รายงาน ▸ สต็อกต่ำ**
  - ใช้คอลัมน์ `qty_total` ซึ่งรวมทุกล็อตที่เปิดใช้งาน
  - ฟิลเตอร์หมวดและสถานะสินค้าได้เช่นเดียวกัน
  - CSV ไม่มีคอลัมน์ราคา (ตรวจสอบว่ามีเฉพาะ `sku,name,qty_total,reorder_point,category`)

## การแจ้งเตือนอีเมล/LINE
- ตั้งค่าช่องทางที่ **Admin ▸ ตั้งค่าระบบ** (`notify_channels`)
- กดปุ่ม "ทดสอบการแจ้งเตือน" เพื่อตรวจว่าอีเมลและ LINE ได้รับข้อความ `[ทดสอบ]`

## เคล็ดลับ
- หากผู้ใช้คนหนึ่งปิดป๊อปอัป อีกผู้ใช้ยังเห็นตามปกติ (state แยกตาม user)
- ตรวจสอบประวัติการแจ้งเตือนจากหน้า **Admin ▸ Notifications** ได้
