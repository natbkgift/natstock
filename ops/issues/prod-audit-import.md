# [Prod Audit] ตรวจความพร้อม workflow นำเข้าไฟล์และไฟล์ error.csv

- **บริบท:** `ImportService` รองรับ preview/commit, transaction, สร้าง `error.csv` และ movement อัตโนมัติ
- **ความเสี่ยง:** หากไม่มีไฟล์ทดสอบหรือไม่มีขั้นตอนล้างไฟล์ tmp อาจเกิดข้อมูลผิดพลาดสะสม, ไฟล์ error ไม่ถูกลบ → กินพื้นที่, ผู้ใช้ commit ไฟล์ผิดโดยไม่รู้ตัว
- **วิธีตรวจ:**
  1. สร้างไฟล์ดี/เสีย แล้วทดสอบผ่านเมนู Import ทั้งโหมด UPSERT และ SKIP
  2. ตรวจโฟลเดอร์ `storage/app/tmp` ว่ามีการล้างไฟล์เก่า
  3. ตรวจบันทึก audit (`import.preview`, `import.commit`)
- **วิธีแก้ (ไม่แตะโค้ด):**
  - จัดชุดไฟล์ตัวอย่างและกระบวนการ QA ก่อนนำเข้า
  - ตั้ง cron หรืองานกำจัดไฟล์ tmp ที่เกิน 7 วัน
  - อบรมผู้ใช้ให้อ่านสรุปก่อนกด commit และดาวน์โหลด error.csv ทุกครั้งที่มี error
- **วิธีแก้ (แตะโค้ดภายหลัง):**
  - เพิ่ม UI แจ้งเตือนถ้ามีไฟล์ error ค้างเกิน N วัน
  - เพิ่มตัวเลือกให้ระบบส่ง error.csv ทางอีเมลอัตโนมัติ
- **DoD:**
  - มีบันทึก test case (ดี/เสีย) พร้อมผลลัพธ์ใน staging/production dry-run
  - โฟลเดอร์ `storage/app/tmp` ไม่มีไฟล์เก่ากว่า SLA
  - ผู้ใช้รับทราบ SOP การนำเข้าและบันทึกไว้ในคู่มือ
- **Labels:** `audit`, `production`, `security`, `ops`
