# การกู้คืนเมื่อนำเข้าไฟล์ล้มเหลว

- **เวลาประมาณ**: 20 นาที ต่อไฟล์ (ขึ้นกับจำนวนแถวผิด)

## Do
- ดาวน์โหลด `error.csv` จากหน้าผลการนำเข้าและเก็บสำเนาในที่ปลอดภัย
- ใช้ LENIENT โหมดสำหรับรอบแก้ไข (commit แถวถูกต้องไปก่อน)
- แก้ไขเฉพาะแถวที่มี error แล้วนำเข้าด้วยไฟล์ย่อย

## Don't
- อย่านำเข้าไฟล์เต็มใน LENIENT ซ้ำโดยไม่ตรวจ error.csv (จะทับค่าที่ถูกต้อง)
- อย่าปรับค่ารหัสล็อต (`sub_sku`) โดยไม่คุยกับทีมสต็อก (อาจกระทบ movement เดิม)

## ขั้นตอนการใช้ error.csv
1. เปิดไฟล์ด้วยโปรแกรมสเปรดชีต (Excel/LibreOffice)
2. ดูคอลัมน์ `error_messages` เพื่อแก้ไขเฉพาะแถวที่มีปัญหา
3. คัดลอกแถวที่แก้เสร็จไปยังไฟล์ใหม่ (ต้องมี header เดิมครบ)
4. นำเข้าไฟล์ย่อยในโหมด **LENIENT** (เลือก auto-create category ตามความจำเป็น)
5. ตรวจผลลัพธ์ว่าทุกแถวผ่านแล้วค่อยกลับมาใช้ STRICT ในรอบถัดไป

## สลับ STRICT ↔ LENIENT
- หน้า Import มี toggle ให้เลือก ก่อนกดยืนยัน
- หากต้องบังคับ strict rollback ด้วยตนเอง ให้ครอบคำสั่งไว้ใน `DB::transaction()` แล้วตรวจ `summary['errors']`

## ตรวจสอบหลังแก้ไข
- เปิดหน้า **การเคลื่อนไหวสต็อก** ตรวจว่ามี movement ถูกสร้างตรงกับล็อต
- เช็กยอด `products.qty` และ `product_batches.qty` ว่าตรงกับไฟล์ที่แก้ไขแล้ว
